<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Dashboard - Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 2rem;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            color: #00ffff;
        }

        .test-section {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .test-section h2 {
            font-size: 1.5rem;
            color: #ffff00;
            margin-bottom: 1rem;
        }

        .test-result {
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-left: 4px solid #00ff00;
            background: #0f0f0f;
        }

        .test-result.pass {
            border-left-color: #00ff00;
        }

        .test-result.fail {
            border-left-color: #ff0000;
            color: #ff6b6b;
        }

        .test-result.warn {
            border-left-color: #ffff00;
            color: #ffff00;
        }

        .test-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .test-detail {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-left: 1rem;
        }

        .summary {
            background: #2a2a2a;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 2rem;
            text-align: center;
        }

        .summary-stat {
            display: inline-block;
            margin: 0 1rem;
            font-size: 1.25rem;
        }

        button {
            background: #00ff00;
            color: #0a0a0a;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin: 0.5rem;
        }

        button:hover {
            background: #00cc00;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔬 Industrial Dashboard Test Suite</h1>

        <div style="text-align: center; margin-bottom: 2rem;">
            <button onclick="runTests()">▶ Run All Tests</button>
            <button onclick="location.reload()">🔄 Reset</button>
        </div>

        <div id="testResults"></div>

        <div class="summary" id="summary" style="display: none;">
            <div class="summary-stat">
                ✓ <span id="passCount">0</span> Passed
            </div>
            <div class="summary-stat">
                ✗ <span id="failCount">0</span> Failed
            </div>
            <div class="summary-stat">
                ⚠ <span id="warnCount">0</span> Warnings
            </div>
        </div>
    </div>

    <script>
        let passCount = 0;
        let failCount = 0;
        let warnCount = 0;

        function addTestResult(sectionId, name, status, detail) {
            const section = document.getElementById(sectionId);
            const result = document.createElement('div');
            result.className = `test-result ${status}`;

            const statusIcon = status === 'pass' ? '✓' : status === 'fail' ? '✗' : '⚠';

            result.innerHTML = `
                <div class="test-name">${statusIcon} ${name}</div>
                <div class="test-detail">${detail}</div>
            `;

            section.appendChild(result);

            if (status === 'pass') passCount++;
            else if (status === 'fail') failCount++;
            else if (status === 'warn') warnCount++;
        }

        function createTestSection(id, title) {
            const container = document.getElementById('testResults');
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `<h2>${title}</h2><div id="${id}"></div>`;
            container.appendChild(section);
        }

        async function runTests() {
            document.getElementById('testResults').innerHTML = '';
            passCount = 0;
            failCount = 0;
            warnCount = 0;

            // Test 1: File Structure
            createTestSection('fileTests', '📁 File Structure Tests');
            testFileStructure();

            // Test 2: Sensor Engine
            createTestSection('sensorTests', '🔧 Sensor Engine Tests');
            await testSensorEngine();

            // Test 3: Chart Engine
            createTestSection('chartTests', '📊 Chart Engine Tests');
            testChartEngine();

            // Test 4: Performance
            createTestSection('perfTests', '⚡ Performance Tests');
            await testPerformance();

            // Show summary
            document.getElementById('passCount').textContent = passCount;
            document.getElementById('failCount').textContent = failCount;
            document.getElementById('warnCount').textContent = warnCount;
            document.getElementById('summary').style.display = 'block';
        }

        function testFileStructure() {
            // Check if running from correct directory
            const path = window.location.pathname;
            if (path.includes('scripts/test.html')) {
                addTestResult('fileTests', 'File location', 'pass', 'Test file in correct location');
            } else {
                addTestResult('fileTests', 'File location', 'warn', 'Test file may not be in scripts directory');
            }

            // Check localStorage capability
            try {
                localStorage.setItem('test', '1');
                localStorage.removeItem('test');
                addTestResult('fileTests', 'LocalStorage', 'pass', 'Browser storage available');
            } catch (e) {
                addTestResult('fileTests', 'LocalStorage', 'fail', 'LocalStorage not available: ' + e.message);
            }

            // Check Canvas support
            const canvas = document.createElement('canvas');
            if (canvas.getContext && canvas.getContext('2d')) {
                addTestResult('fileTests', 'Canvas API', 'pass', 'Canvas 2D context supported');
            } else {
                addTestResult('fileTests', 'Canvas API', 'fail', 'Canvas not supported');
            }
        }

        async function testSensorEngine() {
            try {
                // Load sensor engine script
                await loadScript('../src/sensorEngine.js');

                if (typeof SensorEngine === 'undefined') {
                    addTestResult('sensorTests', 'SensorEngine load', 'fail', 'SensorEngine class not found');
                    return;
                }

                addTestResult('sensorTests', 'SensorEngine load', 'pass', 'SensorEngine class loaded successfully');

                // Create instance
                const engine = new SensorEngine();
                addTestResult('sensorTests', 'SensorEngine instantiation', 'pass', 'Engine instance created');

                // Initialize
                engine.initialize();
                addTestResult('sensorTests', 'Sensor initialization', 'pass',
                    `Initialized ${engine.sensors.length} sensors on ${engine.equipment.length} equipment units`);

                // Check sensor types
                const types = new Set(engine.sensors.map(s => s.type));
                if (types.size >= 5) {
                    addTestResult('sensorTests', 'Sensor diversity', 'pass',
                        `${types.size} different sensor types: ${Array.from(types).join(', ')}`);
                } else {
                    addTestResult('sensorTests', 'Sensor diversity', 'warn',
                        `Only ${types.size} sensor types found`);
                }

                // Test data generation
                engine.start();
                await new Promise(resolve => setTimeout(resolve, 2000));
                engine.stop();

                const snapshot = engine.getCurrentSnapshot();
                addTestResult('sensorTests', 'Data generation', 'pass',
                    `Generated data for ${snapshot.sensors.length} sensors`);

                // Validate data ranges
                let outOfRange = 0;
                snapshot.sensors.forEach(s => {
                    if (s.currentValue < s.min || s.currentValue > s.max) {
                        outOfRange++;
                    }
                });

                if (outOfRange === 0) {
                    addTestResult('sensorTests', 'Data validation', 'pass', 'All sensor values within bounds');
                } else {
                    addTestResult('sensorTests', 'Data validation', 'warn',
                        `${outOfRange} sensors out of range`);
                }

            } catch (e) {
                addTestResult('sensorTests', 'SensorEngine error', 'fail', e.message);
            }
        }

        function testChartEngine() {
            try {
                // Create temporary canvas
                const canvas = document.createElement('canvas');
                canvas.id = 'testCanvas';
                canvas.width = 800;
                canvas.height = 400;
                document.body.appendChild(canvas);

                // Load chart engine
                loadScript('../src/chartEngine.js').then(() => {
                    if (typeof ChartEngine === 'undefined') {
                        addTestResult('chartTests', 'ChartEngine load', 'fail', 'ChartEngine class not found');
                        return;
                    }

                    addTestResult('chartTests', 'ChartEngine load', 'pass', 'ChartEngine class loaded');

                    const chartEngine = new ChartEngine();

                    // Test line chart
                    const lineChart = chartEngine.createLineChart('testCanvas', {
                        title: 'Test Chart',
                        data: [[10, 20, 30, 40, 50]],
                        labels: ['Series 1']
                    });

                    if (lineChart) {
                        addTestResult('chartTests', 'Line chart creation', 'pass', 'Line chart created successfully');
                    } else {
                        addTestResult('chartTests', 'Line chart creation', 'fail', 'Failed to create line chart');
                    }

                    // Test gauge
                    const gauge = chartEngine.createGauge('testCanvas', {
                        title: 'Test Gauge',
                        value: 75,
                        min: 0,
                        max: 100
                    });

                    if (gauge) {
                        addTestResult('chartTests', 'Gauge creation', 'pass', 'Gauge created successfully');
                    } else {
                        addTestResult('chartTests', 'Gauge creation', 'fail', 'Failed to create gauge');
                    }

                    // Cleanup
                    document.body.removeChild(canvas);
                });

            } catch (e) {
                addTestResult('chartTests', 'ChartEngine error', 'fail', e.message);
            }
        }

        async function testPerformance() {
            addTestResult('perfTests', 'Browser', 'pass',
                `${navigator.userAgent.split(' ').slice(-2).join(' ')}`);

            // Memory test
            if (performance.memory) {
                const usedMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
                const totalMB = (performance.memory.totalJSHeapSize / 1048576).toFixed(2);
                addTestResult('perfTests', 'Memory usage', 'pass',
                    `${usedMB} MB / ${totalMB} MB`);
            } else {
                addTestResult('perfTests', 'Memory usage', 'warn', 'Performance memory API not available');
            }

            // Timing test
            const start = performance.now();
            for (let i = 0; i < 100000; i++) {
                Math.random();
            }
            const duration = (performance.now() - start).toFixed(2);
            addTestResult('perfTests', 'Computation speed', 'pass',
                `100k operations in ${duration}ms`);

            // Canvas rendering test
            const canvas = document.createElement('canvas');
            canvas.width = 1000;
            canvas.height = 800;
            const ctx = canvas.getContext('2d');

            const renderStart = performance.now();
            for (let i = 0; i < 1000; i++) {
                ctx.fillStyle = `rgb(${Math.random()*255},${Math.random()*255},${Math.random()*255})`;
                ctx.fillRect(Math.random()*1000, Math.random()*800, 10, 10);
            }
            const renderDuration = (performance.now() - renderStart).toFixed(2);

            if (renderDuration < 100) {
                addTestResult('perfTests', 'Canvas rendering', 'pass',
                    `1000 shapes in ${renderDuration}ms`);
            } else {
                addTestResult('perfTests', 'Canvas rendering', 'warn',
                    `1000 shapes in ${renderDuration}ms (may be slow)`);
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Auto-run tests on load
        window.addEventListener('load', () => {
            console.log('Test page loaded. Click "Run All Tests" to begin.');
        });
    </script>
</body>
</html>
